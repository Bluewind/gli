<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>todo</title>
  <link rel="stylesheet" href="docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>todo</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Setup'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Setup">&#182;</a>
        </div>
        <h1>Setup</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>First, require &lsquo;gli&rsquo; so we have access to the DSL</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;gli&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>Next, require our app&rsquo;s library for business logic</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;todo&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;yaml&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;date&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p><code>GLI::App</code> brings in the DSL methods you&rsquo;ll need.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="kp">include</span> <span class="no">GLI</span><span class="o">::</span><span class="no">App</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>We now describe our program; this will be show to users in the help output</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">program_desc</span> <span class="s1">&#39;Manage a task list that can be easily decomposed into smaller tasks&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>We can specify our app&rsquo;s version here. <code>Claret::VERSION</code> is defined in <code>lib/todo/version.rb</code>, which is brought in by require &lsquo;todo&rsquo; above.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">version</span> <span class="no">Claret</span><span class="o">::</span><span class="no">VERSION</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Note that if you are upgrading from GLI 2.5 or earlier, you must include this in your app to get the latest subcommand features.</p>

<p>For GLI apps scaffolded from 2.6 or greater, this should be inserted for you</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">subcommand_option_handling</span> <span class="ss">:normal</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Parse arguments (not options) in a strict fasion. This allows us to specify certain arguments as required, as well as some limited cardinality.  GLI apps produced via scaffolding will have this set, but it&rsquo;s not the default.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">arguments</span> <span class="ss">:strict</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>We specify our own custom type conversion, from a string to a Date. We&rsquo;ll see this in use a bit later. This works exactly like it does with OptionParser</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">accept</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">string</span><span class="o">|</span>
  <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-Global_Options'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Global_Options">&#182;</a>
        </div>
        <h1>Global Options</h1>

<p>A flag to override where the task list lives. We start off, as in Rake, by providing a description of the flag first. We follow that by naming the argument with <code>arg_name</code>. This will show up in the help output as a reminder to the user of what the argument is. We then name the default value for this argument via <code>default_value</code>. This, too, will show up in the help and be available in global_options when the command executes. Finally, we declare the flag and name it, giving it two different names, a short-form (<code>-t</code>) and a long-form (<code>&mdash;tasklist</code>)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">desc</span> <span class="s1">&#39;Specify the file where the tasklist lives&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Previous versions of GLI accepted <code>arg_name</code>, which simply documented the arguments.  That still works, but it&rsquo;s preferable to use <code>arg</code>, as you can specify that args to your commands are required (or not).  Here, we specify that <code>path</code> is optional.  If we&rsquo;d omitted that, GLI would require it on the command-line when the app is invoked.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">arg</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="ss">:optional</span>
<span class="n">default_value</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="p">,</span><span class="s1">&#39;.todo.yml&#39;</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">[</span><span class="ss">:t</span><span class="p">,</span><span class="ss">:tasklist</span><span class="o">]</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Now, create a switch for &ldquo;verbose&rdquo; mode. As before, we first document it using desc, followed by naming the switch with switch. This will create two options the user can use: </p>

<ul>
<li><code>todo &mdash;verbose # =&gt; global_options[:verbose] is true</code></li>
<li><code>todo &mdash;no-verbose # =&gt; global_options[:verbose] is false</code></li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">desc</span> <span class="s1">&#39;Be verbose&#39;</span>
<span class="n">switch</span> <span class="s1">&#39;verbose&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-Commands'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Commands">&#182;</a>
        </div>
        <h1>Commands</h1>

<p>Define a new command, &ldquo;add&rdquo;. As with other things in GLI, we first document it using desc. We then use <code>long_desc</code> to provide a more detailed explanation. desc is used in the output of todo help while the <code>long_desc</code> is includeed in the output to todo help add. Since add takes arguments, we use <code>arg_name</code> to give it a name. This won&rsquo;t require the argument; it&rsquo;s merely for documentation. Finally, we name the command using command and give it a block, which will allow us to define command-specific options as well add code for the command.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">desc</span> <span class="s1">&#39;Add a new task to do&#39;</span>
<span class="n">long_desc</span> <span class="sx">%{</span>
<span class="sx">  Add a new task to the list.  The task name can be specified with or without quotes</span>
<span class="sx">}</span>
<span class="n">arg</span> <span class="s1">&#39;task name&#39;</span>
<span class="n">command</span> <span class="ss">:add</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Inside here, we can add switches and flags. Let&rsquo;s add a switch that sets the new task&rsquo;s priority. We do this the same was as we added the &mdash;verbose switch.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">c</span><span class="o">.</span><span class="n">desc</span> <span class="s1">&#39;Make the new task the highest priority task&#39;</span>
  <span class="n">c</span><span class="o">.</span><span class="n">switch</span> <span class="o">[</span><span class="ss">:p</span><span class="p">,</span><span class="ss">:priority</span><span class="o">]</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Let&rsquo;s add a &ldquo;due date&rdquo; flag. For this one, use the alternative form that takes an options hash. We also want to coerce this into a <code>Date</code>, so we pass <code>Date</code> as the value for the <code>:type</code> option. This also shows using a dynamic value for the default value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">c</span><span class="o">.</span><span class="n">flag</span> <span class="s1">&#39;due-date&#39;</span><span class="p">,</span> <span class="ss">:default_value</span> <span class="o">=&gt;</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> 
                     <span class="ss">:arg_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                     <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">Date</span><span class="p">,</span> 
                     <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="s1">&#39;The date on which this task must be completed, in YYYY/MM/DD format&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Now, we write the code for what happens when command is executed by the user. action takes a block containing this code. It&rsquo;s given three arguments: the global options as a Hash, the command-specific options as a Hash, and any unparsed options from the command-line.</p>

<p>Notice how our action block is very simple. Think of this as a controller in your Rails app; don&rsquo;t put too much stuff in here. We&rsquo;ll see where $task_list comes from in a bit.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">c</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> <span class="o">|</span><span class="n">global_options</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
    <span class="vg">$task_list</span> <span class="o">&lt;&lt;</span> <span class="no">Claret</span><span class="o">::</span><span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-Subcommands'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Subcommands">&#182;</a>
        </div>
        <h1>Subcommands</h1>

<p>Let&rsquo;s create a command that takes sub commands. In our case, we want list to take a subcommand as to what to list, e.g. <code>todo list all</code> or <code>todo list wip</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">desc</span> <span class="s1">&#39;List tasks&#39;</span>
<span class="n">long_desc</span> <span class="sx">%{</span>
<span class="sx">  List the tasks in your task list, possibly including completed tasks.  By default, this will list</span>
<span class="sx">  all uncompleted tasks.</span>
<span class="sx">}</span>
<span class="n">command</span> <span class="o">[</span><span class="ss">:list</span><span class="p">,</span><span class="ss">:ls</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Inside the command block, we can declare subcommands by just calling command again. This works the same way it does normally and the command block is where you can define subcommand-specific options.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">c</span><span class="o">.</span><span class="n">desc</span> <span class="s1">&#39;List all tasks, including completed ones&#39;</span>
  <span class="n">c</span><span class="o">.</span><span class="n">command</span> <span class="ss">:all</span> <span class="k">do</span> <span class="o">|</span><span class="n">all</span><span class="o">|</span>
    <span class="n">all</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> 
      <span class="no">Claret</span><span class="o">::</span><span class="no">TaskListTerminalSerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="vg">$task_list</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">c</span><span class="o">.</span><span class="n">desc</span> <span class="s1">&#39;List only tasks in-progress&#39;</span>
  <span class="n">c</span><span class="o">.</span><span class="n">command</span> <span class="ss">:wip</span> <span class="k">do</span> <span class="o">|</span><span class="n">wip</span><span class="o">|</span>
    <span class="n">wip</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span>
      <span class="no">Claret</span><span class="o">::</span><span class="no">TaskListTerminalSerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:wip</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="vg">$task_list</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">c</span><span class="o">.</span><span class="n">desc</span> <span class="s1">&#39;List tasks that are not completed&#39;</span>
  <span class="n">c</span><span class="o">.</span><span class="n">command</span> <span class="o">[</span><span class="ss">:tasks</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">tasks</span><span class="o">|</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> <span class="o">|</span><span class="n">global_options</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
      <span class="no">Claret</span><span class="o">::</span><span class="no">TaskListTerminalSerializer</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="vg">$task_list</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>While we could declare an action block for the top-level command, we instead defer it to the &lsquo;tasks&rsquo; subcommand. This means if the user does <code>todo list</code>, it will be the same as <code>todo list tasks</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">c</span><span class="o">.</span><span class="n">default_command</span> <span class="ss">:tasks</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>We do the same thing for some more commands</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">desc</span> <span class="s1">&#39;Complete, start, or split up tasks in your task list&#39;</span>
<span class="n">arg</span> <span class="s1">&#39;task_id&#39;</span>
<span class="n">command</span> <span class="ss">:task</span> <span class="k">do</span> <span class="o">|</span><span class="n">task_command</span><span class="o">|</span>
  <span class="n">task_command</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span> 

    <span class="n">desc</span> <span class="s1">&#39;Complete a task&#39;</span>
    <span class="n">command</span> <span class="ss">:done</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
      <span class="n">c</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> <span class="o">|</span><span class="n">global_options</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
        <span class="vg">$task_list</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">complete!</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">desc</span> <span class="s1">&#39;Start a task&#39;</span>
    <span class="n">arg</span> <span class="s1">&#39;task_id&#39;</span>
    <span class="n">command</span> <span class="ss">:start</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
      <span class="n">c</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> <span class="o">|</span><span class="n">global_options</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
        <span class="vg">$task_list</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">start!</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">desc</span> <span class="s1">&#39;Split a task into two or more subtasks&#39;</span>
    <span class="n">long_desc</span> <span class="sx">%{</span>
<span class="sx">Decomposes a task into more tasks, to make it easier to show progress.  The task names can be specified</span>
<span class="sx">in two ways:  a comma delimited list, unquotes, or a series of quoted arguments.  The task you split</span>
<span class="sx">will be removed and replaced with the new tasks</span>
<span class="sx">}</span>
    <span class="n">arg</span> <span class="s1">&#39;task, task[, task]*&#39;</span>
    <span class="n">command</span> <span class="ss">:split</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
      <span class="n">c</span><span class="o">.</span><span class="n">action</span> <span class="k">do</span> <span class="o">|</span><span class="n">global_options</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
        <span class="vg">$task_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">shift</span><span class="p">,</span><span class="no">Claret</span><span class="o">::</span><span class="no">SmartTaskParser</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-Hooks'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Hooks">&#182;</a>
        </div>
        <h1>Hooks</h1>

<p>Here, we can do any setup we need before each command is run. We have access to the options and arguments, as well as the command, if we need it. We set up our task list here; since this is called before our command action block runs, it&rsquo;ll be ready and waiting.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">pre</span> <span class="k">do</span> <span class="o">|</span><span class="n">global</span><span class="p">,</span><span class="n">command</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="n">args</span><span class="o">|</span>
  <span class="vg">$task_list_serializer</span> <span class="o">=</span> <span class="no">Claret</span><span class="o">::</span><span class="no">TaskListYamlSerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">global</span><span class="o">[</span><span class="ss">:t</span><span class="o">]</span><span class="p">)</span>
  <span class="vg">$task_list</span> <span class="o">=</span> <span class="vg">$task_list_serializer</span><span class="o">.</span><span class="n">read</span>
  <span class="kp">true</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>To run code after the command successfully completes, we can use the post hook. In our case, we write out the possibly-updated tasklist.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">post</span> <span class="k">do</span>
  <span class="vg">$task_list_serializer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="vg">$task_list</span><span class="p">)</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-Run!'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Run!">&#182;</a>
        </div>
        <h1>Run!</h1>

<p>This kickstarts our application. run returns the exit status requested by the app, so we exit with whatever is returned.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">exit</span> <span class="n">run</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
